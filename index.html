<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Gestionale Treni</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
  <meta name="theme-color" content="#0f172a" />

  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

  <!-- AUTH SCREEN -->
  <section id="auth-screen" class="auth-screen">
    <h2>Accesso Gestionale Treni</h2>

    <form id="login-form" class="auth-form">
      <label>Email
        <input type="email" id="auth-email" autocomplete="email" required />
      </label>

      <label>Password
        <input type="password" id="auth-password" autocomplete="current-password" required />
      </label>

      <button type="submit">Accedi</button>
    </form>

    <div class="auth-sep">oppure</div>

    <form id="register-form" class="auth-form">
      <button type="submit">Registrati</button>
    </form>

    <p id="auth-message" class="status"></p>
  </section>

  <!-- APP -->
  <div id="app" class="hidden">
    <header class="topbar">
      <h1>Gestionale Treni</h1>
      <button id="logout-btn" class="logout-btn" type="button">Logout</button>
    </header>

    <nav class="tabs">
      <button data-tab="calendar" class="active" type="button">Calendario</button>
      <button data-tab="new" type="button">Nuova attività</button>
      <button data-tab="list" type="button">Registro treni</button>
      <button data-tab="settings" type="button">Impostazioni</button>
    </nav>

    <main>

      <!-- CALENDARIO -->
      <section id="tab-calendar" class="tab active">
        <h2>Calendario attività</h2>

        <div class="calendar-header">
          <button id="cal-prev" type="button">‹</button>
          <span id="cal-month-label"></span>
          <button id="cal-next" type="button">›</button>
        </div>

        <div id="calendar-grid" class="calendar-grid"></div>

        <div class="day-summary">
          <h3 id="cal-day-title">Seleziona un giorno</h3>
          <p><strong>Totale ore (decimi):</strong> <span id="cal-day-hours">0.0</span></p>

          <table class="table">
            <thead>
              <tr>
                <th>Modello</th>
                <th>Matricola</th>
                <th>Scadenza</th>
                <th>Abilitazione</th>
                <th>Decimi</th>
                <th>Note</th>
                <th>Azioni</th>
              </tr>
            </thead>
            <tbody id="cal-day-activities"></tbody>
          </table>
        </div>
      </section>

      <!-- NUOVA ATTIVITÀ -->
      <section id="tab-new" class="tab">
        <h2>Nuova attività</h2>

        <form id="form-new-activity" class="card">
          <label>Data
            <input type="date" id="input-date" required />
          </label>

          <label>Modello
            <select id="input-model" required>
              <option value="E464">E464</option>
              <option value="TAF">TAF</option>
              <option value="POP">POP</option>
              <option value="JAZZ">JAZZ</option>
              <option value="ROCK">ROCK</option>
            </select>
          </label>

          <label>Matricola
            <select id="input-trainId" required></select>
          </label>

          <label>Scadenza
            <select id="input-scadenza" required></select>
          </label>

          <label>Abilitazione
            <select id="input-abilitazione" required></select>
          </label>

          <label>Tempo (decimi)
            <input id="input-timeDeci" placeholder="es. 0.5, 1.2, 2.0" required />
          </label>

          <label>Note
            <textarea id="input-notes" rows="2"></textarea>
          </label>

          <button type="submit">Salva</button>
          <p id="save-status" class="status"></p>
          <p class="hint">Le opzioni (Matricole/Scadenze/Abilitazioni) si gestiscono in “Impostazioni”.</p>
        </form>
      </section>

      <!-- REGISTRO TRENI -->
      <section id="tab-list" class="tab">
        <h2>Registro treni</h2>

        <table class="table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Modello</th>
              <th>Matricola</th>
              <th>Scadenza</th>
              <th>Abilitazione</th>
              <th>Decimi</th>
              <th>Note</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <tbody id="activities-table-body"></tbody>
        </table>
      </section>

      <!-- IMPOSTAZIONI -->
      <section id="tab-settings" class="tab">
        <h2>Impostazioni</h2>

        <div class="settings-grid">
          <div class="card">
            <h3>Matricole per modello</h3>
            <form id="form-add-trainId" class="settings-form">
              <label>Modello
                <select id="settings-train-model">
                  <option value="E464">E464</option>
                  <option value="TAF">TAF</option>
                  <option value="POP">POP</option>
                  <option value="JAZZ">JAZZ</option>
                  <option value="ROCK">ROCK</option>
                </select>
              </label>
              <label>Matricola
                <input id="settings-trainId" placeholder="es. E464-123" />
              </label>
              <button type="submit">Aggiungi</button>
            </form>
            <ul id="list-trainIds" class="settings-list"></ul>
          </div>

          <div class="card">
            <h3>Scadenze</h3>
            <form id="form-add-scadenza" class="settings-form">
              <label>Nome scadenza
                <input id="settings-scadenza" placeholder="es. Controllo mensile SCMT" />
              </label>
              <button type="submit">Aggiungi</button>
            </form>
            <ul id="list-scadenze" class="settings-list"></ul>
          </div>

          <div class="card">
            <h3>Abilitazioni</h3>
            <form id="form-add-abilitazione" class="settings-form">
              <label>Nome abilitazione
                <input id="settings-abilitazione" placeholder="es. Verifica VT3" />
              </label>
              <button type="submit">Aggiungi</button>
            </form>
            <ul id="list-abilitazioni" class="settings-list"></ul>
          </div>
        </div>

        <p class="hint">Clicca “✕” accanto a una voce per eliminarla.</p>
      </section>

    </main>
  </div>

  <!-- MODAL EDIT -->
  <div id="modal-overlay" class="modal-overlay hidden"></div>
  <div id="edit-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-content">
      <h2>Modifica attività</h2>

      <form id="form-edit-activity" class="modal-form">
        <input type="hidden" id="edit-id" />

        <label>Data
          <input type="date" id="edit-date" required />
        </label>

        <label>Modello
          <select id="edit-model" required>
            <option value="E464">E464</option>
            <option value="TAF">TAF</option>
            <option value="POP">POP</option>
            <option value="JAZZ">JAZZ</option>
            <option value="ROCK">ROCK</option>
          </select>
        </label>

        <label>Matricola
          <select id="edit-trainId" required></select>
        </label>

        <label>Scadenza
          <select id="edit-scadenza" required></select>
        </label>

        <label>Abilitazione
          <select id="edit-abilitazione" required></select>
        </label>

        <label>Decimi
          <input id="edit-timeDeci" required />
        </label>

        <label>Note
          <textarea id="edit-notes" rows="2"></textarea>
        </label>

        <div class="modal-actions">
          <button type="submit">Salva</button>
          <button type="button" id="edit-cancel" class="btn-ghost">Annulla</button>
        </div>
      </form>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
